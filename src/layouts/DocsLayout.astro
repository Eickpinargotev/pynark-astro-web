---
export interface Props {
  title: string;
  description?: string;
}

const { title, description = 'Documentación de precios y guía de instalación' } = Astro.props;

// Construir índice simple de documentación en build y embebido como JSON para el cliente.
// Usamos el query ?raw para obtener el contenido fuente de cada MDX.
const rawModules = import.meta.glob('../pages/docs/**/*.mdx', { eager: true, import: 'default', query: '?raw' });
const __docIndex = Object.entries(rawModules).map(([origPath, content]) => {
  // El glob con query devuelve claves que terminan en ?raw; lo eliminamos para procesar la ruta real.
  let p = origPath.replace(/\?raw$/, '');
  const raw = String(content||'');
  let title = '';
  if (raw.startsWith('---')) {
    const end = raw.indexOf('\n---',3); if (end!==-1){ const fm = raw.slice(3,end); const m = fm.match(/title:\s*(.+)/i); if(m) title = m[1].replace(/^['"`]|['"`]$/g,'').trim(); }
  }
  const h1 = raw.match(/^#\s+(.+)$/m); const h2 = raw.match(/^##\s+(.+)$/m);
  if(!title) title = h1?.[1] || h2?.[1] || 'Documento';
  const headings = Array.from(raw.matchAll(/^#{1,3}\s+(.+)$/gm)).map(m=>m[1].trim());
  // Limpieza adicional: eliminar líneas de import/export ESM para que no aparezcan en snippets.
  const cleaned = raw
    .replace(/^(?:import|export)\s+[^\n]*$/gm,' ') // quita imports/exports de una línea
    .replace(/export\s+const\s+prerender\s*=\s*true\s*;?/gi,' ');
  const text = cleaned
    .replace(/---[\s\S]*?---/,' ')
    .replace(/```[\s\S]*?```/g,' ')
    .replace(/`[^`]+`/g,' ')
    .replace(/<[^>]+>/g,' ')
    .replace(/!\[[^\]]*\]\([^)]*\)/g,' ')
    .replace(/\[[^\]]*\]\([^)]*\)/g,' ')
    .replace(/[#>*_~`]+/g,' ')
    .replace(/\\/g,' ')
    .replace(/\s+/g,' ') // compactar
    .trim()
    .slice(0, 8000);
  let url = p.replace(/\\/g,'/').replace(/^.*\/pages/,'').replace(/\.mdx$/,'').replace(/\/index$/,'/');
  if(!url.startsWith('/')) url = '/' + url;
  return { url, title, headings, text };
}).filter(r => r.url.startsWith('/docs/'));
---

<!DOCTYPE html>
<html lang="es" class="scroll-smooth dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="theme-color" content="#3b82f6" />
    <link rel="icon" type="image/png" href="/assets/pynark_favicon.png" />
  <title>{title}</title>
  {(() => { const json = JSON.stringify(__docIndex).replace(/</g,'\\u003c'); return <script type="application/json" id="__doc-index" set:html={json} /> })()}
  </head>
  <body class="bg-white dark:bg-slate-950 text-slate-900 dark:text-slate-100">
    <!-- Topbar estilo Cursor Docs -->
  <header class="sticky top-0 z-[80] border-b border-slate-200/60 dark:border-slate-800/70 bg-white/70 dark:bg-slate-950/70 backdrop-blur">
      <div class="max-w-7xl mx-auto h-14 px-4 sm:px-6 lg:px-8 flex items-center gap-3">
        <button id="sidebar-open" class="lg:hidden p-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-900">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M3 12h18"/><path d="M3 18h18"/></svg>
        </button>
        <a href="/" class="flex items-center gap-2 pr-2">
          <img src="/assets/pynark_favicon.png" class="w-6 h-6" alt="Pynark" />
          <span class="font-semibold hidden sm:block">Pynark Docs</span>
        </a>
        <div class="flex-1 max-w-[640px]">
          <div class="relative z-[140]" id="doc-search">
            <svg class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            <input id="doc-search-input" placeholder="Buscar en la documentación…" class="w-full pl-9 pr-3 py-2 rounded-lg bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-800 text-sm placeholder:text-slate-400 focus:outline-none focus:ring-2 focus:ring-primary-500/40" autocomplete="off" aria-autocomplete="list" aria-controls="doc-search-list" />
            <div id="doc-search-dropdown" class="absolute left-0 right-0 top-full mt-2 md:mt-1 w-full bg-white dark:bg-slate-950 border border-slate-200 dark:border-slate-800 rounded-lg shadow-2xl md:shadow-lg overflow-hidden hidden z-[130]">
              <ul id="doc-search-list" class="max-h-[70vh] md:max-h-72 overflow-auto text-sm"></ul>
            </div>
          </div>
        </div>
        <a href="/pricing" class="hidden md:inline text-sm text-slate-600 dark:text-slate-300 hover:text-primary-600 dark:hover:text-primary-400">Volver a Pricing</a>
        <button id="theme-toggle-docs" class="p-2 rounded-lg text-slate-600 dark:text-slate-300 hover:bg-slate-100 dark:hover:bg-slate-900">
          <svg id="icon-moon" class="hidden w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79Z"/></svg>
          <svg id="icon-sun" class="hidden w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4V2m0 20v-2m8-8h2M2 12h2m13.657-6.343 1.414-1.414M4.929 19.071l1.414-1.414m12.728 0 1.414 1.414M6.343 5.657 4.929 4.243"/><circle cx="12" cy="12" r="4"/></svg>
        </button>
      </div>
  </header>

  <!-- Backdrop para búsqueda en móvil (debajo del header para no tapar el dropdown) -->
  <div id="doc-search-backdrop" class="fixed inset-0 bg-slate-900/25 dark:bg-black/45 backdrop-blur-sm hidden md:hidden z-[60]"></div>

    <!-- Grid de 3 columnas: sidebar / contenido / ToC -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 grid grid-cols-1 lg:grid-cols-[260px_minmax(0,1fr)_260px] gap-6">
      <!-- Sidebar -->
  <aside id="sidebar" class="fixed inset-y-0 left-0 z-30 w-72 bg-white dark:bg-slate-950 border-r border-slate-200 dark:border-slate-800 p-4 overflow-y-auto transform -translate-x-full transition-transform duration-200 lg:static lg:translate-x-0 lg:w-auto lg:p-0 lg:border-0">
        <nav class="lg:sticky lg:top-24 space-y-6 text-sm">
          <div class="group">
            <button class="w-full flex items-center justify-between text-left text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">
              <span>Empezar</span>
            </button>
            <ul class="space-y-1 pl-1">
              <li><a class="block px-2 py-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900" href="/docs/Empezar/Instalacion">Instalación</a></li>
            </ul>
          </div>
          <div class="group">
            <button class="w-full flex items-center justify-between text-left text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2">
              <span>Cuenta</span>
            </button>
            <ul class="space-y-1 pl-1">
              <li><a class="block px-2 py-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900" href="/docs/cuenta/pricing">Pricing</a></li>
            </ul>
          </div>
        </nav>
      </aside>

      <!-- Contenido principal -->
      <main class="min-w-0">
        <article id="doc-article" data-pagefind-body class="prose prose-slate dark:prose-invert max-w-none">
          <slot />
        </article>
      </main>

      <!-- Tabla de contenidos (ToC) -->
      <aside class="hidden xl:block">
        <div class="sticky top-24">
          <div class="text-xs font-semibold text-slate-500 uppercase tracking-wider mb-3">En esta página</div>
          <nav id="toc" class="text-sm space-y-1"></nav>
        </div>
      </aside>
    </div>

    <footer class="py-8 text-center text-sm text-slate-500">
      <p>© 2025 Pynark — Documentación</p>
    </footer>

    <script>
      // @ts-nocheck
      // Búsqueda ligera del lado del cliente
      ;(function initLightSearch() {
  const container = document.getElementById('doc-search');
        const input = document.getElementById('doc-search-input');
        const dropdown = document.getElementById('doc-search-dropdown');
        const list = document.getElementById('doc-search-list');
  const backdrop = document.getElementById('doc-search-backdrop');
  const DEBUG_SEARCH = true;
        if (!container || !input || !dropdown || !list) return;

    const showBackdrop = (on) => {
      if (!backdrop) return;
      if (on) backdrop.classList.remove('hidden');
      else backdrop.classList.add('hidden');
    };

        const setMobileOverlay = (on) => {
          // En móvil, convertir el contenedor en un overlay por encima del header y el menú
          const isMobile = window.matchMedia('(max-width: 767px)').matches;
          if (!isMobile) return; // sólo en móvil
          const hamburger = document.getElementById('sidebar-open');
          const themeBtn = document.getElementById('theme-toggle-docs');
          if (on) {
            container.classList.remove('relative');
            container.classList.add('fixed','inset-x-0','top-2','px-3','w-full');
            hamburger?.classList.add('opacity-0','pointer-events-none');
            themeBtn?.classList.add('opacity-0','pointer-events-none');
            document.body.classList.add('overflow-hidden');
          } else {
            container.classList.remove('fixed','inset-x-0','top-2','px-3','w-full');
            container.classList.add('relative');
            hamburger?.classList.remove('opacity-0','pointer-events-none');
            themeBtn?.classList.remove('opacity-0','pointer-events-none');
            document.body.classList.remove('overflow-hidden');
          }
        };

        let index = null; // { entries: [{url,title,headings:string[],text:string}] }
        let active = -1; // índice activo en la lista para navegación con teclado
        let lastQuery = '';

        const fetchIndex = async () => {
          if (index) return index;
          // 1. Intentar índice embebido
          try {
            const embedded = document.getElementById('__doc-index');
            if (embedded?.textContent) {
              const arr = JSON.parse(embedded.textContent);
              if (Array.isArray(arr) && arr.length) {
                index = { entries: arr };
                if (DEBUG_SEARCH) console.info('[Search] índice embebido cargado', arr.length);
                return index;
              }
            }
          } catch (e) { console.warn('Índice embebido inválido', e); }
          // 2. Intentar JSON externo
            try {
              const res = await fetch('/docs/search-index.json', { cache: 'no-store' });
              if (res.ok) {
                const data = await res.json();
                if (data && Array.isArray(data.entries) && data.entries.length) {
                  index = data; return index;
                }
              }
            } catch (e) { /* ignorar */ }
          // 3. Fallback Pagefind
          try {
            if (typeof window !== 'undefined' && !window.pagefind && !document.getElementById('pagefind-script')) {
              const s = document.createElement('script');
              s.id = 'pagefind-script';
              s.src = '/pagefind/' + 'pagefind.js';
              s.async = true; document.head.appendChild(s);
              await new Promise((res, rej) => { s.onload = () => res(); s.onerror = () => rej(new Error('No cargó pagefind.js')); });
            }
            if (window.pagefind) { index = { entries: null, usePagefind: true }; return index; }
          } catch (e) { console.warn('No se pudo inicializar Pagefind', e); }
          index = { entries: [] }; return index;
        };

        const normalize = (s='') => s
          .toLowerCase()
          .normalize('NFD')
          .replace(/\p{Diacritic}/gu,'');
        const score = (q, entry) => {
          const query = normalize(q);
          const title = normalize(entry.title || '');
          const heads = normalize((entry.headings || []).join(' \n '));
          const text = normalize(entry.text || '');
          let s = 0;
          if (title.includes(query)) s += 10;
          if (heads.includes(query)) s += 5;
          if (text.includes(query)) s += 2;
          // bonus por prefijo
          if (title.startsWith(query)) s += 5;
          return s;
        };

        const highlight = (snippet, q) => {
          if (!q) return snippet;
          const safe = snippet.replace(/[<>]/g,'');
          try {
            const n = normalize(q);
            // dividir palabras básicas del query
            const parts = n.split(/\s+/).filter(Boolean).slice(0,4);
            if (!parts.length) return safe;
            let pattern = parts.map(p => p.replace(/[-/\\^$*+?.()|[\]{}]/g,'\\$&')).join('|');
            const re = new RegExp(`(${pattern})`,`gi`);
            return safe.replace(re, m => `<mark class="bg-yellow-200 dark:bg-yellow-500/40 text-inherit rounded px-0.5">${m}</mark>`);
          } catch { return safe; }
        };
        const render = (items, q) => {
          list.innerHTML = '';
          active = -1;
          if (!items.length) {
            if ((q||'').trim().length >= 2) {
              const li = document.createElement('li');
              li.className = 'px-3 py-2 text-slate-500 text-sm';
              li.textContent = 'Sin resultados';
              list.appendChild(li);
              dropdown.classList.remove('hidden');
              showBackdrop(true);
              setMobileOverlay(true);
              input.setAttribute('aria-expanded','true');
            } else {
              dropdown.classList.add('hidden');
              showBackdrop(false);
              setMobileOverlay(false);
              input.setAttribute('aria-expanded', 'false');
            }
            return;
          }
          items.slice(0, 8).forEach((it, i) => {
            const li = document.createElement('li');
            li.className = 'px-3 py-2 hover:bg-slate-100 dark:hover:bg-slate-900 cursor-pointer';
            li.setAttribute('role', 'option');
            const shownTitle = it.title || it.url;
            const snippet = it.snippet || '';
            li.innerHTML = `
              <div class=\"font-medium\">${highlight(shownTitle, q)}</div>
              ${snippet ? `<div class=\"text-xs text-slate-500 line-clamp-2\">${highlight(snippet, q)}</div>` : ''}
            `;
            li.addEventListener('mousedown', (e) => { // mousedown para no perder foco antes del click
              e.preventDefault();
              window.location.href = it.url;
            });
            list.appendChild(li);
          });
          dropdown.classList.remove('hidden');
          showBackdrop(true);
          setMobileOverlay(true);
          input.setAttribute('aria-expanded', 'true');
        };

        const search = async (q) => {
          const data = await fetchIndex();
          // Pagefind fallback mode
          if (data.usePagefind) {
            try {
              const query = q.trim();
              if (!query) { dropdown.classList.add('hidden'); showBackdrop(false); setMobileOverlay(false); input.setAttribute('aria-expanded','false'); return; }
              const pfRes = await window.pagefind.search(query);
              const items = await Promise.all((pfRes?.results || []).slice(0,30).map(async r => {
                const d = await r.data();
                return {
                  url: d.url,
                  title: d.meta?.title || d.url,
                  snippet: d.content_excerpt || (d.content || '').slice(0,160),
                  _score: r.score || 0
                };
              }));
              // Ordenar por score desc
              items.sort((a,b)=> (b._score||0) - (a._score||0));
              render(items, q);
              return;
            } catch (e) {
              console.warn('Error buscando con Pagefind', e);
              dropdown.classList.add('hidden');
              showBackdrop(false);
              setMobileOverlay(false);
              input.setAttribute('aria-expanded','false');
              return;
            }
          }
          const entries = data.entries || [];
          const query = q.trim();
          if (!query) { dropdown.classList.add('hidden'); showBackdrop(false); setMobileOverlay(false); input.setAttribute('aria-expanded','false'); return; }
          if (DEBUG_SEARCH) console.info('[Search] entradas disponibles', entries.length);
          const ranked = entries
            .map((e) => ({
              ...e,
              _score: score(query, e),
              match: '',
            }))
            .filter((e) => e._score > 0)
            .sort((a,b) => b._score - a._score);
          if (DEBUG_SEARCH) console.info('[Search] ranked length', ranked.length);
          if (!ranked.length) {
            // fallback substring
            const nq = normalize(query);
            const fb = entries.filter(e => normalize(e.title||'').includes(nq) || normalize(e.text||'').includes(nq)).slice(0,20);
            if (DEBUG_SEARCH) console.info('[Search] fallback substring length', fb.length);
            if (fb.length) {
              fb.forEach((e) => {
                const plain = e.text || '';
                const low = normalize(plain);
                const idx = low.indexOf(nq);
                let snippet = plain.slice(0, 140) + (plain.length>140?'…':'');
                if (idx !== -1) {
                  const start = Math.max(0, idx - 40);
                  snippet = plain.slice(start, idx + nq.length + 80).trim();
                  if (start > 0) snippet = '…' + snippet;
                  if (idx + nq.length + 80 < plain.length) snippet += '…';
                }
                e.snippet = snippet;
              });
              render(fb, query); return;
            }
          }

          // genera snippet simple
          ranked.forEach((e) => {
            const plain = e.text || '';
            const nq = normalize(query);
            // buscar ventana alrededor de la primera coincidencia normalizada
            const low = normalize(plain);
            const idx = low.indexOf(nq);
            let snippet = '';
            if (idx !== -1) {
              const start = Math.max(0, idx - 40);
              snippet = plain.slice(start, idx + nq.length + 80).trim();
              if (start > 0) snippet = '…' + snippet;
              if (idx + nq.length + 80 < plain.length) snippet += '…';
            } else {
              snippet = plain.slice(0, 140) + (plain.length>140 ? '…':'');
            }
            e.snippet = snippet;
          });
          render(ranked, query);
        };

        let debounce;
        input.addEventListener('input', (e) => {
          const q = e.target.value;
          lastQuery = q;
          // Mostrar overlay mientras escribe, aunque aún no haya resultados
          setMobileOverlay(true);
          showBackdrop(true);
          clearTimeout(debounce);
          debounce = setTimeout(() => search(q), 120);
        });

        input.addEventListener('focus', () => {
          // Activar overlay y backdrop al enfocar el input en móvil
          setMobileOverlay(true);
          showBackdrop(true);
          if (lastQuery) search(lastQuery); else if (input.value.trim()) { lastQuery = input.value; search(lastQuery); }
        });

        input.addEventListener('blur', () => {
          // Si se pierde el foco y no se hizo click en resultados, cerrar overlay/backdrop
          setTimeout(() => {
            if (dropdown.classList.contains('hidden')) {
              setMobileOverlay(false);
              showBackdrop(false);
            }
          }, 50);
        });

        // Soporta navegación y búsqueda inmediata al presionar Enter aunque el debounce no haya terminado
        input.addEventListener('keydown', async (e) => {
          let items = Array.from(list.children);
          if (e.key === 'ArrowDown') {
            if (!items.length) return; // sin resultados aún
            e.preventDefault(); active = (active + 1) % items.length; updateActive(items); return;
          }
          if (e.key === 'ArrowUp') {
            if (!items.length) return;
            e.preventDefault(); active = (active - 1 + items.length) % items.length; updateActive(items); return;
          }
          if (e.key === 'Enter') {
            e.preventDefault();
            // Si aún no hay ítems visibles (debounce en curso), forzar búsqueda inmediata
            if (!items.length) {
              await search(input.value);
              items = Array.from(list.children);
            }
            if (items.length) {
              if (active === -1) active = 0; // por defecto el primero
              const target = items[active];
              if (target) target.dispatchEvent(new MouseEvent('mousedown'));
            }
            return;
          }
          if (e.key === 'Escape') {
            dropdown.classList.add('hidden');
            showBackdrop(false);
            setMobileOverlay(false);
            input.setAttribute('aria-expanded','false');
            return;
          }
        });

        // Accesibilidad básica
        input.setAttribute('role','combobox');
        input.setAttribute('aria-expanded','false');
        input.setAttribute('aria-haspopup','listbox');
        list.setAttribute('role','listbox');

        function updateActive(items) {
          items.forEach((el, i) => el.classList.toggle('bg-slate-100', i === active));
          const activeEl = items[active];
          if (activeEl) activeEl.scrollIntoView({ block: 'nearest' });
        }

        document.addEventListener('click', (e) => {
          if (!container.contains(e.target)) { dropdown.classList.add('hidden'); showBackdrop(false); setMobileOverlay(false); }
        });

        // Cerrar al tocar el backdrop
        backdrop?.addEventListener('click', () => {
          dropdown.classList.add('hidden');
          showBackdrop(false);
          setMobileOverlay(false);
          input.setAttribute('aria-expanded','false');
        });
      })();

      // Sidebar mobile toggle
      const sidebar = document.getElementById('sidebar');
      const openBtn = document.getElementById('sidebar-open');
      openBtn?.addEventListener('click', () => sidebar?.classList.toggle('-translate-x-full'));
      // Close on click outside (mobile)
      document.addEventListener('click', (e) => {
        if (!sidebar) return;
        if (window.innerWidth >= 1024) return;
        const t = e.target;
        const withinSidebar = t instanceof Node ? sidebar.contains(t) : false;
        const clickedOpen = t instanceof Node && openBtn ? openBtn.contains(t) : false;
        if (!withinSidebar && !clickedOpen && !sidebar.classList.contains('-translate-x-full')) {
          sidebar.classList.add('-translate-x-full');
        }
      });

      // Theme toggle (independent from main layout)
      const themeBtn = document.getElementById('theme-toggle-docs');
      const sun = document.getElementById('icon-sun');
      const moon = document.getElementById('icon-moon');
      function reflectThemeIcons() {
        const isDark = document.documentElement.classList.contains('dark');
        if (isDark) { sun?.classList.remove('hidden'); moon?.classList.add('hidden'); }
        else { moon?.classList.remove('hidden'); sun?.classList.add('hidden'); }
      }
      reflectThemeIcons();
      themeBtn?.addEventListener('click', () => {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('color-theme', isDark ? 'dark' : 'light');
        document.documentElement.style.colorScheme = isDark ? 'dark' : 'light';
        reflectThemeIcons();
      });

      // Generate anchors and ToC from article headings (h2, h3)
      const article = document.getElementById('doc-article');
      const toc = document.getElementById('toc');
      /** @type {(text: string) => string} */
      const slugify = (text) => {
        return text
          .toLowerCase()
          .normalize('NFD').replace(/\p{Diacritic}/gu, '')
          .replace(/[^a-z0-9\s-]/g, '')
          .trim()
          .replace(/\s+/g, '-')
          .replace(/-+/g, '-');
      }
      function buildToc() {
        if (!article || !toc) return;
        const headings = Array.from(article.querySelectorAll('h2, h3'));
        toc.innerHTML = '';
        const list = document.createElement('ul');
        list.className = 'space-y-1';
        headings.forEach((h) => {
          if (!h.id) {
            h.id = slugify(h.textContent || '');
          }
          // add anchor icon
          if (!h.querySelector('a.anchor')) {
            const a = document.createElement('a');
            a.href = `#${h.id}`;
            a.className = 'anchor opacity-0 group-hover:opacity-100 ml-2 text-slate-400 hover:text-primary-600';
            a.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="inline w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 13a5 5 0 0 1 7 0l1 1a5 5 0 0 1-7 7l-1-1"/><path d="M14 11a5 5 0 0 1-7 0l-1-1a5 5 0 0 1 7-7l1 1"/></svg>';
            h.classList.add('group');
            h.appendChild(a);
          }
          const li = document.createElement('li');
          const link = document.createElement('a');
          link.href = `#${h.id}`;
          link.textContent = h.textContent || '';
          link.className = `block px-2 py-1 rounded hover:bg-slate-100 dark:hover:bg-slate-900 ${h.tagName === 'H3' ? 'ml-3' : ''}`;
          li.appendChild(link);
          list.appendChild(li);
        });
        toc.appendChild(list);
      }
      buildToc();

      // Scroll spy for ToC
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          const id = entry.target.getAttribute('id');
          if (!id) return;
          const link = toc?.querySelector(`a[href="#${CSS.escape(id)}"]`);
          if (!link) return;
          if (entry.isIntersecting) {
            toc?.querySelectorAll('a').forEach((a) => a.classList.remove('text-primary-600'));
            link.classList.add('text-primary-600');
          }
        });
      }, { rootMargin: '0px 0px -70% 0px', threshold: [0, 1] });
      document.querySelectorAll('#doc-article h2, #doc-article h3').forEach((h) => observer.observe(h));
    </script>
  </body>
</html>

<style>
  .prose :where(code):not(:where(pre code)) {
    background: rgba(148,163,184,0.15);
    padding: 0.2rem 0.35rem;
    border-radius: 0.375rem;
  }
  .prose :where(h2,h3) {
    scroll-margin-top: 96px;
  }
</style>
