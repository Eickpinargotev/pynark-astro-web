---
import Layout from '../layouts/Layout.astro';
import ChatSimulation from '../components/ChatSimulation.tsx';
// Nota: se eliminó el chat de prueba. Mantenemos solo los componentes necesarios.
---

<Layout title="Pynark Automation - Chatbots que Convierten">
  <!-- Hero Section -->
  <section class="py-20 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto text-center">
      <h1 class="font-display text-4xl sm:text-5xl lg:text-6xl font-bold text-slate-900 dark:text-white mb-6">
        Chatbots que convierten <br class="hidden sm:block">
        <span class="bg-gradient-to-r from-primary-600 to-secondary-600 bg-clip-text text-transparent">
          visitas en ventas y citas
        </span>
      </h1>
      <p class="text-xl text-slate-600 dark:text-slate-300 mb-12 max-w-3xl mx-auto">
        Especialistas en agentes de servicio al cliente que funcionan 24/7 para hacer crecer tu negocio.
      </p>
    </div>
  </section>

  <!-- Servicios Section -->
  <section id="servicios" class="py-20 px-4 sm:px-6 lg:px-8 scroll-mt-24 bg-gradient-to-br from-primary-50/50 to-secondary-50/40 dark:from-primary-900/10 dark:to-secondary-900/10">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-14">
        <h2 class="font-display text-3xl sm:text-4xl font-bold text-slate-900 dark:text-white mb-3">
          Lo que hacemos en Pynark Automation
        </h2>
        <p class="text-slate-600 dark:text-slate-300 max-w-3xl mx-auto">
          Arquitectura, agentes y automatización conectados a tus canales y datos.
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
        <!-- Card: Infraestructura de IA autónoma -->
        <article class="group relative overflow-hidden rounded-3xl border border-slate-200/70 dark:border-slate-700/60 bg-white/70 dark:bg-slate-800/70 shadow-lg hover:shadow-xl transition-all">
          <div class="absolute -top-12 -right-12 w-40 h-40 rounded-full bg-gradient-to-br from-primary-500/20 to-secondary-500/20 blur-2xl"></div>
          <div class="p-7">
            <div class="flex items-center gap-3">
              <div class="text-3xl">🧠</div>
              <h3 class="font-display text-xl font-semibold text-slate-900 dark:text-white">Infraestructura de IA autónoma</h3>
            </div>
            <ul class="mt-4 space-y-3 text-slate-600 dark:text-slate-300">
              <li class="flex gap-3"><span class="mt-1">⚙️</span><span>Diseño e implementación de agentes orquestados, colas de tareas, logs y monitoreo.</span></li>
              <li class="flex gap-3"><span class="mt-1">🔗</span><span>CRM a tu elección: Integración con HubSpot, Salesforce, Zoho, etc., con sincronización bidireccional de contactos, deals y actividades.</span></li>
              <li class="flex gap-3"><span class="mt-1">💬</span><span>Soporte multicanal: WhatsApp, Instagram, Facebook y Telegram en una sola capa conversacional.</span></li>
              <li class="flex gap-3"><span class="mt-1">🗄️</span><span>Base de datos y gobierno del dato: Modelado, limpieza y accesos seguros para alimentar a tus agentes y reportes.</span></li>
            </ul>
          </div>
          <div class="pointer-events-none absolute left-0 right-0 bottom-0 h-[3px] bg-gradient-to-r from-primary-500 to-secondary-500 scale-x-0 group-hover:scale-x-100 origin-left transition-transform"></div>
        </article>

        <!-- Card: Agentes de IA que responden 24/7 -->
        <article class="group relative overflow-hidden rounded-3xl border border-slate-200/70 dark:border-slate-700/60 bg-white/70 dark:bg-slate-800/70 shadow-lg hover:shadow-xl transition-all">
          <div class="absolute -top-12 -right-12 w-40 h-40 rounded-full bg-gradient-to-br from-emerald-500/20 to-teal-500/20 blur-2xl"></div>
          <div class="p-7">
            <div class="flex items-center gap-3">
              <div class="text-3xl">🤖</div>
              <h3 class="font-display text-xl font-semibold text-slate-900 dark:text-white">Agentes de IA que responden 24/7</h3>
            </div>
            <ul class="mt-4 space-y-3 text-slate-600 dark:text-slate-300">
              <li class="flex gap-3"><span class="mt-1">🎧</span><span>Atención al cliente automatizada with respuestas naturales, precisas y consistentes, y handoff a humano cuando haga falta.</span></li>
              <li class="flex gap-3"><span class="mt-1">📚</span><span>Conocimiento actualizado: conexión a FAQs, catálogo, políticas y documentos internos.</span></li>
              <li class="flex gap-3"><span class="mt-1">✨</span><span>Control de tono y marca: personalidad configurable para mantener tu identidad.</span></li>
            </ul>
          </div>
          <div class="pointer-events-none absolute left-0 right-0 bottom-0 h-[3px] bg-gradient-to-r from-emerald-500 to-teal-500 scale-x-0 group-hover:scale-x-100 origin-left transition-transform"></div>
        </article>

        <!-- Card: Automatización con n8n -->
        <article class="group relative overflow-hidden rounded-3xl border border-slate-200/70 dark:border-slate-700/60 bg-white/70 dark:bg-slate-800/70 shadow-lg hover:shadow-xl transition-all">
          <div class="absolute -top-12 -right-12 w-40 h-40 rounded-full bg-gradient-to-br from-amber-500/20 to-orange-500/20 blur-2xl"></div>
          <div class="p-7">
            <div class="flex items-center gap-3">
              <div class="text-3xl">🕸️</div>
              <h3 class="font-display text-xl font-semibold text-slate-900 dark:text-white">Automatización con n8n</h3>
            </div>
            <ul class="mt-4 space-y-3 text-slate-600 dark:text-slate-300">
              <li class="flex gap-3"><span class="mt-1">🔁</span><span>Workflows operativos: automatización de tareas repetitivas (altas/bajas, validaciones, disparadores por evento).</span></li>
              <li class="flex gap-3"><span class="mt-1">🧩</span><span>Integración total: conectores con ERP, CRM, pasarelas de pago, formularios y calendarios.</span></li>
              <li class="flex gap-3"><span class="mt-1">🛡️</span><span>Orquestación avanzada: ramas condicionales, manejo de errores, reintentos y alertas.</span></li>
            </ul>
          </div>
          <div class="pointer-events-none absolute left-0 right-0 bottom-0 h-[3px] bg-gradient-to-r from-amber-500 to-orange-500 scale-x-0 group-hover:scale-x-100 origin-left transition-transform"></div>
        </article>

        <!-- Card: Automatización de ventas -->
        <article class="group relative overflow-hidden rounded-3xl border border-slate-200/70 dark:border-slate-700/60 bg-white/70 dark:bg-slate-800/70 shadow-lg hover:shadow-xl transition-all">
          <div class="absolute -top-12 -right-12 w-40 h-40 rounded-full bg-gradient-to-br from-fuchsia-500/20 to-violet-500/20 blur-2xl"></div>
          <div class="p-7">
            <div class="flex items-center gap-3">
              <div class="text-3xl">💼</div>
              <h3 class="font-display text-xl font-semibold text-slate-900 dark:text-white">Automatización de ventas</h3>
            </div>
            <ul class="mt-4 space-y-3 text-slate-600 dark:text-slate-300">
              <li class="flex gap-3"><span class="mt-1">🧲</span><span>Gestión de leads: captura, scoring y enrutamiento automático.</span></li>
              <li class="flex gap-3"><span class="mt-1">📨</span><span>Nurturing y seguimiento: secuencias por email y WhatsApp, recordatorios y tareas para tu equipo comercial.</span></li>
              <li class="flex gap-3"><span class="mt-1">📅</span><span>Citas y demos: agendado automático con confirmaciones y recordatorios.</span></li>
            </ul>
          </div>
          <div class="pointer-events-none absolute left-0 right-0 bottom-0 h-[3px] bg-gradient-to-r from-fuchsia-500 to-violet-500 scale-x-0 group-hover:scale-x-100 origin-left transition-transform"></div>
        </article>

        <!-- Card: Analítica, Dashboards & KPIs -->
        <article class="group relative overflow-hidden rounded-3xl border border-slate-200/70 dark:border-slate-700/60 bg-white/70 dark:bg-slate-800/70 shadow-lg hover:shadow-xl transition-all xl:col-span-2">
          <div class="absolute -top-12 -right-12 w-40 h-40 rounded-full bg-gradient-to-br from-sky-500/20 to-cyan-500/20 blur-2xl"></div>
          <div class="p-7">
            <div class="flex items-center gap-3">
              <div class="text-3xl">📊</div>
              <h3 class="font-display text-xl font-semibold text-slate-900 dark:text-white">Analítica, Dashboards & KPIs</h3>
            </div>
            <ul class="mt-4 space-y-3 text-slate-600 dark:text-slate-300">
              <li class="flex gap-3"><span class="mt-1">⏱️</span><span>Dashboards en tiempo real: métricas clave de atención, conversión, ventas y satisfacción.</span></li>
              <li class="flex gap-3"><span class="mt-1">📬</span><span>Reportes automáticos: envío programado con insights accionables.</span></li>
              <li class="flex gap-3"><span class="mt-1">🧪</span><span>Optimización continua: A/B testing de flujos, prompts y secuencias para mejorar conversiones.</span></li>
            </ul>
          </div>
          <div class="pointer-events-none absolute left-0 right-0 bottom-0 h-[3px] bg-gradient-to-r from-sky-500 to-cyan-500 scale-x-0 group-hover:scale-x-100 origin-left transition-transform"></div>
        </article>
      </div>
    </div>
  </section>

  <!-- How We Work Section (rediseño con emojis) -->
  <section id="proceso" class="py-20 px-4 sm:px-6 lg:px-8 scroll-mt-24">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <h2 class="font-display text-3xl sm:text-4xl font-bold text-slate-900 dark:text-white mb-3">
          ¿Cómo trabajamos?
        </h2>
        <p class="text-slate-600 dark:text-slate-300 max-w-3xl mx-auto">
          Un proceso claro y estructurado para garantizar el éxito de tu automatización
        </p>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
        <!-- Card 1 -->
        <div class="group relative bg-white dark:bg-slate-800 rounded-3xl p-8 shadow-lg border border-slate-200 dark:border-slate-700 hover:shadow-xl transition-all text-center md:text-left">
          <div class="absolute -top-5 left-1/2 -translate-x-1/2 md:left-8 md:translate-x-0">
            <div class="w-14 h-14 rounded-full bg-gradient-to-r from-primary-600 to-secondary-600 flex items-center justify-center text-2xl shadow-lg">
              <span class="text-white font-bold">1</span>
            </div>
          </div>
          <div class="mt-6 text-5xl mx-auto md:mx-0">🛠️</div>
          <p class="mt-2 text-xs font-medium text-slate-500 dark:text-slate-400">Paso 1/4</p>
          <h3 class="mt-3 font-display text-xl font-semibold text-slate-900 dark:text-white">
            Diagnóstico
          </h3>
          <p class="mt-2 text-slate-600 dark:text-slate-300">
            Sesión de 30-45 minutos para entender tu negocio y necesidades específicas
          </p>
        </div>

        <!-- Card 2 -->
        <div class="group relative bg-white dark:bg-slate-800 rounded-3xl p-8 shadow-lg border border-slate-200 dark:border-slate-700 hover:shadow-xl transition-all text-center md:text-left">
          <div class="absolute -top-5 left-1/2 -translate-x-1/2 md:left-8 md:translate-x-0">
            <div class="w-14 h-14 rounded-full bg-gradient-to-r from-primary-600 to-secondary-600 flex items-center justify-center text-2xl shadow-lg">
              <span class="text-white font-bold">2</span>
            </div>
          </div>
          <div class="mt-6 text-5xl mx-auto md:mx-0">🤖</div>
          <p class="mt-2 text-xs font-medium text-slate-500 dark:text-slate-400">Paso 2/4</p>
          <h3 class="mt-3 font-display text-xl font-semibold text-slate-900 dark:text-white">
            Setup de vertical
          </h3>
          <p class="mt-2 text-slate-600 dark:text-slate-300">
            Configuración personalizada del agente en 2-5 días según tu industria
          </p>
        </div>

        <!-- Card 3 -->
        <div class="group relative bg-white dark:bg-slate-800 rounded-3xl p-8 shadow-lg border border-slate-200 dark:border-slate-700 hover:shadow-xl transition-all text-center md:text-left">
          <div class="absolute -top-5 left-1/2 -translate-x-1/2 md:left-8 md:translate-x-0">
            <div class="w-14 h-14 rounded-full bg-gradient-to-r from-primary-600 to-secondary-600 flex items-center justify-center text-2xl shadow-lg">
              <span class="text-white font-bold">3</span>
            </div>
          </div>
          <div class="mt-6 text-5xl mx-auto md:mx-0">🧪</div>
          <p class="mt-2 text-xs font-medium text-slate-500 dark:text-slate-400">Paso 3/4</p>
          <h3 class="mt-3 font-display text-xl font-semibold text-slate-900 dark:text-white">
            Go-live con monitoreo
          </h3>
          <p class="mt-2 text-slate-600 dark:text-slate-300">
            Lanzamiento con supervisión activa para garantizar el rendimiento óptimo
          </p>
        </div>

        <!-- Card 4 -->
        <div class="group relative bg-white dark:bg-slate-800 rounded-3xl p-8 shadow-lg border border-slate-200 dark:border-slate-700 hover:shadow-xl transition-all text-center md:text-left">
          <div class="absolute -top-5 left-1/2 -translate-x-1/2 md:left-8 md:translate-x-0">
            <div class="w-14 h-14 rounded-full bg-gradient-to-r from-primary-600 to-secondary-600 flex items-center justify-center text-2xl shadow-lg">
              <span class="text-white font-bold">4</span>
            </div>
          </div>
          <div class="mt-6 text-5xl mx-auto md:mx-0">🚀</div>
          <p class="mt-2 text-xs font-medium text-slate-500 dark:text-slate-400">Paso 4/4</p>
          <h3 class="mt-3 font-display text-xl font-semibold text-slate-900 dark:text-white">
            Optimización mensual
          </h3>
          <p class="mt-2 text-slate-600 dark:text-slate-300">
            Reportes detallados con insights y mejoras continuas del rendimiento
          </p>
        </div>
      </div>

      <!-- CTA under process section -->
      <div class="mt-12 text-center">
        <a href="/#contact" class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-primary-600 to-secondary-600 hover:from-primary-700 hover:to-secondary-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 transition-all duration-300">
          Comenzar diagnóstico
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Examples Section -->
  <section class="py-20 px-4 sm:px-6 lg:px-8 bg-gradient-to-br from-slate-50 to-primary-50/30 dark:from-slate-900 dark:to-primary-900/10">
    <div class="max-w-7xl mx-auto">
      <div class="text-center mb-16">
        <h2 class="font-display text-3xl sm:text-4xl font-bold text-slate-900 dark:text-white mb-6">
          Ejemplos en acción
        </h2>
        <p class="text-xl text-slate-600 dark:text-slate-300 max-w-3xl mx-auto">
          Descubre cómo nuestros agentes manejan diferentes situaciones reales de negocio
        </p>
      </div>
      
      <ChatSimulation client:load />
    </div>
  </section>

  <!-- Contact Section -->
  <section id="contact" class="py-20 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
      <div class="text-center mb-12">
        <h2 class="font-display text-3xl sm:text-4xl font-bold text-slate-900 dark:text-white mb-6">
          Contáctanos
        </h2>
        <p class="text-xl text-slate-600 dark:text-slate-300">
          ¿Listo para transformar tu atención al cliente? Hablemos
        </p>
      </div>
      
      <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-200 dark:border-slate-700 p-8">
  <form id="contact-form" class="space-y-6" novalidate action="https://paneln8n.erickpinargote.com/webhook/contacto_pynark" method="POST">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label for="name" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Nombre
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                placeholder="Tu nombre completo"
              />
            </div>
            <div>
              <label for="email" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Email
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                placeholder="tu@email.com"
              />
            </div>
            <div>
              <label for="phone" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
                Teléfono
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                required
                inputmode="tel"
                autocomplete="tel"
                class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
                placeholder="Ej: +593 99 999 9999"
              />
            </div>
          </div>
          
          <div>
            <label for="company" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Empresa
            </label>
            <input
              type="text"
              id="company"
              name="company"
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              placeholder="Nombre de tu empresa"
            />
          </div>
          
          <div>
            <label for="message" class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">
              Mensaje
            </label>
            <textarea
              id="message"
              name="message"
              rows="4"
              required
              class="w-full px-4 py-3 border border-slate-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-700 text-slate-900 dark:text-slate-100 placeholder-slate-500 dark:placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none"
              placeholder="Cuéntanos sobre tu proyecto y cómo podemos ayudarte..."
            ></textarea>
          </div>
          
          <div class="space-y-4">
            <div id="contact-status" class="text-sm" aria-live="polite"></div>
            <button
              id="contact-submit"
              type="submit"
              class="w-full px-8 py-4 bg-gradient-to-r from-primary-600 to-secondary-600 hover:from-primary-700 hover:to-secondary-700 text-white font-semibold rounded-xl shadow-lg hover:shadow-xl transform hover:-translate-y-1 transition-all duration-300 disabled:opacity-60 disabled:cursor-not-allowed"
            >
              Enviar mensaje
            </button>
          </div>
        </form>
      </div>
    </div>
  </section>

  <script>
    // Prevent initial unwanted scroll
    document.addEventListener('DOMContentLoaded', () => {
      // Reset scroll position if no specific hash is intended
      if (!window.location.hash || window.location.hash === '#') {
        window.scrollTo(0, 0);
      }
    });
    // Scripts del formulario de contacto
  // --- Contact form submission to n8n webhook ---
  (function initContactForm(){
    const form = document.getElementById('contact-form') as HTMLFormElement | null;
    if(!form) return;
    const statusEl = document.getElementById('contact-status');
    const submitBtn = document.getElementById('contact-submit') as HTMLButtonElement | null;
    const WEBHOOK_URL = 'https://paneln8n.erickpinargote.com/webhook/contacto_pynark';

    // Optional simple honeypot
    if(!form.querySelector('[name="_hp"]')){
      const hp = document.createElement('input');
      hp.type = 'text';
      hp.name = '_hp';
      hp.tabIndex = -1;
      hp.autocomplete = 'off';
      hp.style.position = 'absolute';
      hp.style.left = '-9999px';
      form.appendChild(hp);
    }

    const setStatus = (msg: string, type: 'info'|'success'|'error') => {
      if(!statusEl) return;
      const base = 'px-4 py-3 rounded-lg border text-sm font-medium';
      const styles: Record<string,string> = {
        info: 'bg-slate-100 dark:bg-slate-700/50 text-slate-700 dark:text-slate-200 border-slate-300 dark:border-slate-600',
        success: 'bg-emerald-100 dark:bg-emerald-900/30 text-emerald-800 dark:text-emerald-200 border-emerald-300 dark:border-emerald-700',
        error: 'bg-rose-100 dark:bg-rose-900/30 text-rose-800 dark:text-rose-200 border-rose-300 dark:border-rose-700'
      };
      statusEl.className = base + ' ' + styles[type];
      statusEl.textContent = msg;
    };

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if(submitBtn?.disabled) return; // prevent double
      const formData = new FormData(form);
      // Honeypot detection
      if((formData.get('_hp') as string)?.trim().length){
        setStatus('Enviado', 'success'); // Pretend success to bots
        return;
      }
      const name = (formData.get('name')||'').toString().trim();
      const email = (formData.get('email')||'').toString().trim();
      const phone = (formData.get('phone')||'').toString().trim();
      const company = (formData.get('company')||'').toString().trim();
      const message = (formData.get('message')||'').toString().trim();

      if(!name || !email || !phone || !message){
        setStatus('Por favor completa los campos requeridos.', 'error');
        return;
      }

      const payload = {
        name,
        email,
        phone,
        company: company || null,
        message,
        submitted_at: new Date().toISOString(),
        source: 'website_contact_form',
        user_agent: navigator.userAgent
      };

      try {
        submitBtn && (submitBtn.disabled = true);
        setStatus('Enviando tu mensaje...', 'info');
        const resp = await fetch(WEBHOOK_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        if(!resp.ok){
          throw new Error('Status ' + resp.status);
        }
        setStatus('¡Mensaje enviado! Te contactaremos muy pronto.', 'success');
        form.reset();
        // Foco accesible
        setTimeout(() => { statusEl?.scrollIntoView({behavior:'smooth', block:'center'}); }, 50);
      } catch(err){
        console.error('Error enviando formulario', err);
        setStatus('No se pudo enviar. Intenta nuevamente en unos segundos.', 'error');
      } finally {
        submitBtn && (submitBtn.disabled = false);
      }
    });
  })();
  </script>

  <style>
    @keyframes fade-in {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .animate-fade-in {
      animation: fade-in 0.5s ease-out forwards;
    }
    
  </style>
</Layout>
